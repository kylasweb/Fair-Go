# Render.com Deployment Guide

## 🚀 Why Render.com for FairGo

✅ **Better Next.js Support** - Native Next.js detection and optimization
✅ **Reliable Health Checks** - More forgiving deployment validation
✅ **Integrated PostgreSQL** - Seamless database setup
✅ **Real-time Logs** - Better debugging capabilities
✅ **Socket.IO Friendly** - Excellent WebSocket support
✅ **Environment Variables** - Easy configuration management
✅ **Auto-deploys** - GitHub integration with branch protection
✅ **Custom Domains** - Free SSL certificates

## 📋 Render.com Setup Steps

### 1. Create Render Account

1. Go to https://render.com
2. Sign up with GitHub account
3. Connect your Fair-Go repository

### 2. Create Web Service

```
1. Click "New" → "Web Service"
2. Connect GitHub and select "Fair-Go" repository
3. Configure deployment settings:
   - Name: fairgo-production
   - Environment: Node
   - Build Command: npm run render-build
   - Start Command: npm run start:render
   - Instance Type: Free (or Starter $7/month)
```

**IMPORTANT**: Make sure to use the exact build/start commands above! 
The `render-build` script includes `--legacy-peer-deps` to resolve dependency conflicts.

### 3. Add PostgreSQL Database

```
1. Click "New" → "PostgreSQL"
2. Name: fairgo-database
3. Plan: Free (or Starter $7/month)
4. Copy the Internal Database URL for environment variables
```

### 4. Environment Variables

Add these in Render dashboard under "Environment":

```env
# Database (Auto-generated by Render PostgreSQL)
DATABASE_URL=<your-render-postgres-internal-url>

# Required Application Variables
NODE_ENV=production
NEXTAUTH_SECRET=a21b3f9d5e6c78a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f3a4
NEXTAUTH_URL=https://fairgo-production.onrender.com
SOCKET_IO_SECRET=e6b2c9d0a1e3f4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9

# Optional AI/Service Integration
AI_MODEL_ENDPOINT=https://api.z-ai.cloud/v1
AI_API_KEY=your-ai-api-key
REDIS_URL=redis://red-xxx:6379
ADMIN_EMAIL=admin@fairgo.com

# Twilio (for voice features)
TWILIO_ACCOUNT_SID=your-twilio-sid
TWILIO_AUTH_TOKEN=your-twilio-token
TWILIO_PHONE_NUMBER=your-twilio-number
```

### 5. Deploy Configuration

Create `render.yaml` in your project root:

```yaml
services:
  - type: web
    name: fairgo-production
    env: node
    buildCommand: npm run render-build
    startCommand: npm run start:render
    healthCheckPath: /api/health
    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_URL
        fromDatabase:
          name: fairgo-database
          property: connectionString
databases:
  - name: fairgo-database
    plan: free
```

## 🔧 Render.com Advantages

### Better Health Checks

- More reasonable timeout periods (5+ minutes vs 30 seconds)
- Gradual health check escalation
- Better error reporting and logs
- Option to disable health checks during development

### Superior Next.js Support

```json
// Render automatically detects and optimizes for:
{
  "framework": "nextjs",
  "buildCommand": "npm run build",
  "startCommand": "npm start",
  "nodeVersion": "18.x"
}
```

### Enhanced Logging

- Real-time deployment logs
- Application runtime logs
- Build process visibility
- Error stack traces
- Performance metrics

### Database Integration

- Automatic connection string generation
- Built-in connection pooling
- Backup and recovery options
- Performance monitoring
- Migration support

## 🚀 Migration from Railway

### 1. Export Data (if needed)

```bash
# From Railway PostgreSQL
pg_dump $RAILWAY_DATABASE_URL > fairgo_backup.sql

# Import to Render PostgreSQL
psql $RENDER_DATABASE_URL < fairgo_backup.sql
```

### 2. Update Environment Variables

```bash
# Copy variables from Railway to Render dashboard
# Update NEXTAUTH_URL to: https://fairgo-production.onrender.com
# Update DATABASE_URL to Render PostgreSQL connection
```

### 3. Deploy and Test

```bash
# Render will auto-deploy from GitHub
# Monitor logs in Render dashboard
# Test health endpoint: https://fairgo-production.onrender.com/api/health
```

## 📊 Render.com vs Railway Comparison

| Feature         | Render.com          | Railway              |
| --------------- | ------------------- | -------------------- |
| Health Checks   | Flexible, forgiving | Strict 30s timeout   |
| Next.js Support | Native optimization | Manual configuration |
| Logs            | Real-time, detailed | Limited visibility   |
| Database Setup  | Integrated UI       | CLI-heavy            |
| Debugging       | Excellent tooling   | Basic logs           |
| Free Tier       | 750 hours/month     | $5 credit            |
| Custom Domains  | Free SSL            | Free SSL             |
| Build Times     | Fast                | Variable             |

## 🎯 Why Render.com Should Work Better

1. **Health Check Tolerance** - Render gives your app more time to start
2. **Better Error Handling** - Clearer error messages when things go wrong
3. **Next.js Optimization** - Built-in Next.js deployment optimizations
4. **PostgreSQL Integration** - Smoother database connection handling
5. **Real-time Debugging** - Better visibility into what's failing
6. **Community Support** - Large community with deployment guides

## 🔗 Quick Start Links

- **Render Dashboard**: https://dashboard.render.com
- **Documentation**: https://render.com/docs
- **Next.js Guide**: https://render.com/docs/deploy-nextjs-app
- **PostgreSQL Setup**: https://render.com/docs/databases
- **Environment Variables**: https://render.com/docs/environment-variables

Ready to migrate to Render.com? It should resolve the persistent health check issues you're experiencing with Railway!

## 🔧 Troubleshooting Common Issues

### Build Command Issues
If your deployment fails with dependency errors, make sure you're using the correct commands:

**❌ Wrong (causes ERESOLVE errors):**
- Build Command: `npm install && npm run build`
- Start Command: `npm start`

**✅ Correct:**
- Build Command: `npm run render-build` 
- Start Command: `npm run start:render`

The `render-build` script includes `--legacy-peer-deps` to resolve Express 5.x dependency conflicts.

### Quick Fix for Current Failed Deployment

1. **Go to your Render dashboard**
2. **Click on your service → Settings**
3. **Update Build & Deploy settings:**
   - Build Command: `npm run render-build`
   - Start Command: `npm run start:render`
4. **Click "Save Changes"**
5. **Go to "Deploys" tab and click "Deploy latest commit"**

### Environment Variable Checklist
Make sure these are set in Render dashboard:
- ✅ `DATABASE_URL` (from PostgreSQL service)
- ✅ `NODE_ENV=production`
- ✅ `NEXTAUTH_SECRET` (32+ characters)
- ✅ `NEXTAUTH_URL` (your Render app URL)
- ✅ `SOCKET_IO_SECRET`

### Dependency Resolution Issues
If you see ERESOLVE errors, the build command must include `--legacy-peer-deps`. 
Our `render-build` script handles this automatically.

### Health Check Timeout
Render is much more forgiving than Railway (5+ minutes vs 30 seconds), but if needed:
- Health Check Path: `/api/health`
- Health Check Command: Leave blank (uses HTTP GET)
